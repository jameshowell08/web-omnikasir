generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  userId      String    @id @map("user_id") @db.VarChar(255)
  username    String    @unique @db.VarChar(255)
  password    String    @db.VarChar(255)
  createdDate DateTime? @default(now()) @map("created_date") @db.Timestamp(6)


  userAccesses       UserAccess[]
  transactionHeaders TransactionHeader[]
  
  }

model SeqNo {
  id     BigInt @id @default(autoincrement())
  name   String @unique @db.VarChar(50)
  format String @db.VarChar(10)
  seqno  Int    @default(0)
}

model Store {
  id             String   @id @default(uuid())
  nama           String
  alamat         String
  noHp           String
  profilePicture Bytes?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Customer {
  customerId          String    @id @default(uuid()) @map("customer_id")
  customerName        String    @unique @db.VarChar(255)
  customerPhoneNumber String?
  createdDate         DateTime? @default(now()) @map("created_date") @db.Timestamp(6)

  transactionHeaders TransactionHeader[]
}

model ProductCategory {
  categoryId   String    @id @default(uuid()) @map("category_id")
  categoryName String    @map("category_name")
  description  String?

  createdDate  DateTime  @default(now())
  modifiedDate DateTime  @updatedAt


  createdBy   Users   @relation(fields: [createdByID], references: [user_id])
  modifiedBy  Users?  @relation(fields: [modifiedByID], references: [user_id])
  user Users[]
  products    Product[]
  inventories Inventory[]
}

model Product {
  sku             String            @id @default(uuid())
  productName     String
  brand           String
  categoryId      String          @map("category_id")
  category        ProductCategory @relation(fields: [categoryId], references: [categoryId])

  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt


  createdBy   users   @relation("createdByUser", fields: [createdByID], references: [user_id])
  modifiedBy  users?  @relation("modifiedByUser", fields: [modifiedByID], references: [user_id])
  // Relations
  user Users[]
  skus                ProductSku[]
  transactionDetails  TransactionDetail[] 
  imeis               Imei[]
}

model Imei {
  sku       String
  imei      String 

  product Product @relation(fields: [sku], references: [sku])
}

model ProductInventoryHeader {
  id            String      @id @default(uuid())
  supplier      String 

  createdBy     String
  createdDate   DateTime
  modifiedBy    String
  modifiedDate  DateTime

  createdBy   users   @relation("createdByUser", fields: [createdByID], references: [user_id])
  modifiedBy  users?  @relation("modifiedByUser", fields: [modifiedByID], references: [user_id])

  user Users[]
  productInventoryDetail ProducInventoryDetail[]
}

model ProductInventoryDetail {
  headerId    String   
  sku         String
  quantity    Int
  price       Decimal
  

  productHeader ProductInventoryHeader @relations(fields: [headerId],references: [id])
  @@id([headerId, sku]) primary key
}



model PaymentMethod {
  paymentId   String   @id @default(uuid()) @map("payment_id")
  paymentName String

  transactionHeaders TransactionHeader[]
}

model UserAccess {
  userId String @map("user_id")
  access String

  user Users @relation(fields: [userId], references: [userId])

  @@id([userId, access])
}

model TransactionHeader {
  transactionHeaderId String   @id @map("transactionHeaderID") @db.VarChar(255)
  transactionDate     DateTime
 
  paymentId           String   @map("payment_id")
  userId              String   @map("user_id")
  transactionMethod   String   @db.VarChar(255)
  customerId          String   @map("customer_id")

  paymentMethod       PaymentMethod @relation(fields: [paymentId], references: [paymentId])
  user                Users         @relation(fields: [userId], references: [userId])
  customer            Customer      @relation(fields: [customerId], references: [customerId])
  transactionDetails  TransactionDetail[]
}

model TransactionDetail {
  transactionDetailId String   @id @map("transactionDetailID") @db.VarChar(255)
  transactionHeaderId String   @map("transactionHeaderID")
  transactionHeader   TransactionHeader @relation(fields: [transactionHeaderId], references: [transactionHeaderId])

  skuId    String?  
  sku      ProductSku? @relation(fields: [skuId], references: [skuId])

  productId String? @map("product_id")
  product   Product? @relation(fields: [productId], references: [productId])

  quantity  Int
  price     Decimal  @db.Decimal(12,2)
}