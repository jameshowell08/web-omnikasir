generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
   url       = env("DATABASE_URL")
   directUrl = env("DATABASE_URL_UNPOOLED")
}

model Users {
  userId                   String                   @id @map("user_id") @db.VarChar(255)
   username                 String                   @unique @db.VarChar(255)
  password                 String                   @db.VarChar(255)
  role                     UserRole                 @default(CASHIER)
  isActive                 Boolean                  @default(true) @map("is_active")
  createdDate              DateTime                 @default(now()) @map("created_date") @db.Timestamp(6)
  lastLogin                DateTime?                @map("last_login") @db.Timestamp(6)
  
  // Relations
  createdProducts          Product[]                @relation("ProductCreatedBy")
  modifiedProducts         Product[]                @relation("ProductModifiedBy")
  createdCategories        ProductCategory[]        @relation("ProductCategoryCreatedBy")
  modifiedCategories       ProductCategory[]        @relation("ProductCategoryModifiedBy")
  createdInventoryHeaders  ProductInventoryHeader[] @relation("InventoryHeaderCreatedBy")
  modifiedInventoryHeaders ProductInventoryHeader[] @relation("InventoryHeaderModifiedBy")
  transactionHeaders         TransactionHeader[]
  createdTransactionHeaders  TransactionHeader[] @relation("TransactionHeaderCreatedBy")
  modifiedTransactionHeaders TransactionHeader[] @relation("TransactionHeaderModifiedBy")
}

enum UserRole {
  ADMIN
  CASHIER
}

model SeqNo {
  id     BigInt @id @default(autoincrement())
  name   String @unique @db.VarChar(50)
  format String @db.VarChar(10)
  seqno  Int    @default(0)
}

model Store {
  id             String   @id @default(uuid())
  nama           String
  alamat         String
  noHp           String
  profilePicture Bytes?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Customer {
  customerId          String              @id @default(uuid()) @map("customer_id")
  customerName        String              @unique @db.VarChar(255)
  customerEmail       String?             @unique @db.VarChar(255)
  customerPhoneNumber String?             @unique @db.VarChar(20)
  customerAddress     String?

  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  transactionHeaders  TransactionHeader[]
}

model ProductCategory {
  categoryId   String    @id @default(uuid()) @map("category_id")
  categoryName String    @map("category_name")
  description  String?
  createdDate  DateTime  @default(now())
  modifiedDate DateTime  @updatedAt
  createdById  String
  modifiedById String?
  products     Product[]
  createdBy    Users     @relation("ProductCategoryCreatedBy", fields: [createdById], references: [userId])
  modifiedBy   Users?    @relation("ProductCategoryModifiedBy", fields: [modifiedById], references: [userId])
}

model Product {
  productName             String
  brand                   String
  categoryId              String
  createdById             String
  modifiedById            String?
  sku                     String                   @id @default(uuid())
  buyingPrice             Decimal?                 @db.Decimal(12, 2)
  quantity                Int
  sellingPrice            Decimal                  @db.Decimal(12, 2)
  isNeedImei              Boolean                  
  imeis                   Imei[]

  category                ProductCategory          @relation(fields: [categoryId], references: [categoryId])
  createdBy               Users                    @relation("ProductCreatedBy", fields: [createdById], references: [userId])
  modifiedBy              Users?                   @relation("ProductModifiedBy", fields: [modifiedById], references: [userId])
  
  productInventoryDetails ProductInventoryDetail[]
  transactionDetails      TransactionDetail[]
}

model Imei {
  sku                     String
  imei                    String                   @id
  isSold                  Boolean                  @default(false)
  product                 Product                  @relation(fields: [sku], references: [sku])
  productInventoryDetails ProductInventoryDetail[]
  transactionDetails      TransactionDetail[]
}

model ProductInventoryHeader {
  id          String   @id @default(uuid())
  supplier    String
  status      String   @default("DRAFT") // DRAFT, COMPLETED, CANCELLED
  totalPrice Decimal? @db.Decimal(12, 2)

  createdById  String
  modifiedById String?
  createdDate  DateTime @default(now())
  modifiedDate DateTime @updatedAt

  createdBy  Users  @relation("InventoryHeaderCreatedBy", fields: [createdById], references: [userId])
  modifiedBy Users? @relation("InventoryHeaderModifiedBy", fields: [modifiedById], references: [userId])

  productInventoryDetails ProductInventoryDetail[]
}

model ProductInventoryDetail {
  id       String  @id @default(uuid())
  headerId String
  sku      String
  quantity Int
  price    Decimal @db.Decimal(12, 2)
  imeiCode String?

  productHeader ProductInventoryHeader @relation(fields: [headerId], references: [id])
  imei          Imei?                  @relation(fields: [imeiCode], references: [imei])

  Product    Product? @relation(fields: [sku], references: [sku])
}

model PaymentMethod {
  paymentId          String              @id @default(uuid()) @map("payment_id")
  paymentName        String
  transactionHeaders TransactionHeader[]
}


model TransactionHeader {
  transactionHeaderId String              @id @map("transactionHeaderID") @db.VarChar(255)
  transactionDate     DateTime            @default(now())
  paymentId           String              @map("payment_id")
  userId              String              @map("user_id")
  transactionMethod   String              @db.VarChar(255)
  customerId          String?              @map("customer_id")
  status              String              @default("SUCCESS") // "SUCCESS" or "VOID"
          
  modifiedDate        DateTime            @updatedAt
  modifiedById        String?             @map("modified_by")
  createdById         String              @map("created_by")
  createdDate         DateTime            @default(now())
  createdBy           Users               @relation("TransactionHeaderCreatedBy", fields: [createdById], references: [userId])
  modifiedBy          Users?              @relation("TransactionHeaderModifiedBy", fields: [modifiedById], references: [userId])
  transactionDetails  TransactionDetail[]
  customer            Customer?            @relation(fields: [customerId], references: [customerId])
  paymentMethod       PaymentMethod       @relation(fields: [paymentId], references: [paymentId])
  user                Users               @relation(fields: [userId], references: [userId])
}



model TransactionDetail {
  transactionDetailId String            @id @default(uuid()) @map("transactionDetailID") @db.VarChar(255)
  transactionHeaderId String            @map("transactionHeaderID")
  quantity            Int
  price               Decimal           @db.Decimal(12, 2)
  sku                 String
  imeiCode            String?
  imei                Imei?             @relation(fields: [imeiCode], references: [imei])
  product             Product           @relation(fields: [sku], references: [sku])
  transactionHeader   TransactionHeader @relation(fields: [transactionHeaderId], references: [transactionHeaderId])
}
