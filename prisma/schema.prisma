generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  userId      String    @id @map("user_id") @db.VarChar(255)
  username    String    @unique @db.VarChar(255)
  password    String    @db.VarChar(255)
  createdDate DateTime? @default(now()) @map("created_date") @db.Timestamp(6)

  userAccesses       UserAccess[]
  transactionHeaders TransactionHeader[]
}

model SeqNo {
  id     BigInt @id @default(autoincrement())
  name   String @unique @db.VarChar(50)
  format String @db.VarChar(10)
  seqno  Int    @default(0)
}

model Store {
  id             String   @id @default(uuid())
  nama           String
  alamat         String
  noHp           String
  profilePicture Bytes?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Customer {
  customerId          String    @id @default(uuid()) @map("customer_id")
  customerName        String    @unique @db.VarChar(255)
  customerPhoneNumber String?
  createdDate         DateTime? @default(now()) @map("created_date") @db.Timestamp(6)

  transactionHeaders TransactionHeader[]
}

model ProductCategory {
  categoryId   String    @id @default(uuid()) @map("category_id")
  categoryName String    @map("category_name")
  description  String?

  createdBy    String?
  createdDate  DateTime  @default(now())
  modifiedBy   String?
  modifiedDate DateTime  @updatedAt

  products    Product[]
  inventories Inventory[]
}

model Product {
  productId       String   @id @default(uuid()) @map("product_id")
  productName     String
  brand           String?
  description     String?
  categoryId      String?  @map("category_id")
  category        ProductCategory? @relation(fields: [categoryId], references: [categoryId])

  createdBy    String?
  createdDate  DateTime @default(now())
  modifiedBy   String?
  modifiedDate DateTime @updatedAt

  // Relations
  skus             ProductSku[]
  transactionDetails TransactionDetail[] 
}

model ProductSku {
  skuId         String   @id @default(uuid())
  sku           String   @unique
  productId     String
  product       Product  @relation(fields: [productId], references: [productId])

  barcode       String?  @unique
  priceSell     Decimal  @db.Decimal(12, 2)
  priceBuy      Decimal? @db.Decimal(12, 2)
  stock         Int      @default(0)  // NEW: Stock column
  attributes    Json?    
  serialRequired Boolean @default(false)

  createdDate   DateTime @default(now())
  modifiedDate  DateTime @updatedAt

  // Relations
  inventories    ProductInventory[]
  serialNumbers  SerialNumber[]
  transactionDetails TransactionDetail[] 
}

model ProductInventory {
  id          String   @id @default(uuid())
  skuId       String
  sku         ProductSku @relation(fields: [skuId], references: [skuId])

  inventoryId String?   @map("inventory_id")
  inventory   Inventory? @relation(fields: [inventoryId], references: [inventoryId])

  quantity    Int      @default(0)
  reserved    Int      @default(0) 
  inTransit   Int      @default(0)

  updatedAt   DateTime @updatedAt

  @@unique([skuId, inventoryId], map: "ux_sku_inventory")
}

model SerialNumber {
  serialId   String   @id @default(uuid())
  skuId      String
  sku        ProductSku @relation(fields: [skuId], references: [skuId])

  serialNo   String   @unique
  status     String   @default("IN_STOCK")
  soldAt     DateTime?
  soldTo     String?  
  warrantyUntil DateTime?

  createdDate DateTime @default(now())
  modifiedDate DateTime @updatedAt
}

model Inventory {
  inventoryId String   @id @default(uuid()) @map("inventory_id")
  date        DateTime
  note        String?

  categoryId  String?  @map("category_id")
  category    ProductCategory? @relation(fields: [categoryId], references: [categoryId])

  productInventories ProductInventory[]
}

model PaymentMethod {
  paymentId   String   @id @default(uuid()) @map("payment_id")
  paymentName String

  transactionHeaders TransactionHeader[]
}

model UserAccess {
  userId String @map("user_id")
  access String

  user Users @relation(fields: [userId], references: [userId])

  @@id([userId, access])
}

model TransactionHeader {
  transactionHeaderId String   @id @map("transactionHeaderID") @db.VarChar(255)
  transactionDate     DateTime
  totalPrice          Decimal  @db.Decimal(12,2)
  paymentId           String   @map("payment_id")
  userId              String   @map("user_id")
  transactionMethod   String   @db.VarChar(255)
  customerId          String   @map("customer_id")

  paymentMethod       PaymentMethod @relation(fields: [paymentId], references: [paymentId])
  user                Users         @relation(fields: [userId], references: [userId])
  customer            Customer      @relation(fields: [customerId], references: [customerId])
  transactionDetails  TransactionDetail[]
}

model TransactionDetail {
  transactionDetailId String   @id @map("transactionDetailID") @db.VarChar(255)
  transactionHeaderId String   @map("transactionHeaderID")
  transactionHeader   TransactionHeader @relation(fields: [transactionHeaderId], references: [transactionHeaderId])

  skuId    String?  
  sku      ProductSku? @relation(fields: [skuId], references: [skuId])

  productId String? @map("product_id")
  product   Product? @relation(fields: [productId], references: [productId])

  quantity  Int
  price     Decimal  @db.Decimal(12,2)
}