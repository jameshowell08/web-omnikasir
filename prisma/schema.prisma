generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  userId      String    @id @map("user_id") @db.VarChar(255)
  username    String    @unique @db.VarChar(255)
  password    String    @db.VarChar(255)
  createdDate DateTime? @default(now()) @map("created_date") @db.Timestamp(6)

  userAccesses       UserAccess[]
  transactionHeaders TransactionHeader[]

  // Relasi ke ProductCategory
  createdCategories  ProductCategory[]      @relation("ProductCategoryCreatedBy")
  modifiedCategories ProductCategory[]      @relation("ProductCategoryModifiedBy")

  // Relasi ke Product
  createdProducts    Product[]              @relation("ProductCreatedBy")
  modifiedProducts   Product[]              @relation("ProductModifiedBy")

  // Relasi ke Inventory Header
  createdInventoryHeaders  ProductInventoryHeader[] @relation("InventoryHeaderCreatedBy")
  modifiedInventoryHeaders ProductInventoryHeader[] @relation("InventoryHeaderModifiedBy")
}

model SeqNo {
  id     BigInt @id @default(autoincrement())
  name   String @unique @db.VarChar(50)
  format String @db.VarChar(10)
  seqno  Int    @default(0)
}

model Store {
  id             String   @id @default(uuid())
  nama           String
  alamat         String
  noHp           String
  profilePicture Bytes?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Customer {
  customerId          String    @id @default(uuid()) @map("customer_id")
  customerName        String    @unique @db.VarChar(255)
  customerPhoneNumber String?
  createdDate         DateTime? @default(now()) @map("created_date") @db.Timestamp(6)

  transactionHeaders TransactionHeader[]
}

model ProductCategory {
  categoryId   String    @id @default(uuid()) @map("category_id")
  categoryName String    @map("category_name")
  description  String?

  createdById  String
  modifiedById String?
  createdDate  DateTime  @default(now())
  modifiedDate DateTime  @updatedAt

  createdBy   Users   @relation("ProductCategoryCreatedBy", fields: [createdById], references: [userId])
  modifiedBy  Users?  @relation("ProductCategoryModifiedBy", fields: [modifiedById], references: [userId])

  products    Product[]
}

model Product {
  sku           String  @id @default(uuid())
  productName   String
  brand         String
  categoryId    String
  quantity      Int
  sellingPrice  Decimal  @db.Decimal(12, 2)
  buyingPrice   Decimal?  @db.Decimal(12, 2)

  createdById  String
  modifiedById String?

  category     ProductCategory @relation(fields: [categoryId], references: [categoryId])
  createdBy    Users           @relation("ProductCreatedBy", fields: [createdById], references: [userId])
  modifiedBy   Users?          @relation("ProductModifiedBy", fields: [modifiedById], references: [userId])

  imeis                 Imei[]
  transactionDetails    TransactionDetail[]
  productInventoryDetails ProductInventoryDetail[]
}

model Imei {
  sku       String
  imei      String    @id
  isSold    Boolean   @default(false)

  product Product @relation(fields: [sku], references: [sku])

  productInventoryDetails   ProductInventoryDetail[]
  transactionDetails        TransactionDetail[]
}

model ProductInventoryHeader {
  id            String      @id @default(uuid())
  supplier      String 

  createdById   String
  modifiedById  String?
  createdDate   DateTime    @default(now())
  modifiedDate  DateTime    @updatedAt

  createdBy   Users   @relation("InventoryHeaderCreatedBy", fields: [createdById], references: [userId])
  modifiedBy  Users?  @relation("InventoryHeaderModifiedBy", fields: [modifiedById], references: [userId])

  productInventoryDetails ProductInventoryDetail[]
}

model ProductInventoryDetail {
  headerId  String
  sku       String
  quantity  Int
  price     Decimal  @db.Decimal(12, 2)
  imeiCode  String?

  productHeader ProductInventoryHeader @relation(fields: [headerId], references: [id])
  product       Product                @relation(fields: [sku], references: [sku])
  imei          Imei?                  @relation(fields: [imeiCode], references: [imei])

  @@id([headerId, sku])
}

model PaymentMethod {
  paymentId   String   @id @default(uuid()) @map("payment_id")
  paymentName String

  transactionHeaders TransactionHeader[]
}

model UserAccess {
  userId String @map("user_id")
  access String

  user Users @relation(fields: [userId], references: [userId])

  @@id([userId, access])
}

model TransactionHeader {
  transactionHeaderId String   @id @map("transactionHeaderID") @db.VarChar(255)
  transactionDate     DateTime
  paymentId           String   @map("payment_id")
  userId              String   @map("user_id")
  transactionMethod   String   @db.VarChar(255)
  customerId          String   @map("customer_id")

  paymentMethod       PaymentMethod @relation(fields: [paymentId], references: [paymentId])
  user                Users         @relation(fields: [userId], references: [userId])
  customer            Customer      @relation(fields: [customerId], references: [customerId])
  transactionDetails  TransactionDetail[]
}

model TransactionDetail {
  transactionDetailId  String   @id @map("transactionDetailID") @db.VarChar(255)
  transactionHeaderId  String   @map("transactionHeaderID")
  quantity             Int
  price                Decimal  @db.Decimal(12,2)
  sku                  String  
  imeiCode             String?

  transactionHeader TransactionHeader @relation(fields: [transactionHeaderId], references: [transactionHeaderId])
  product           Product?          @relation(fields: [sku], references: [sku])
  imei              Imei?             @relation(fields:[imeiCode], references: [imei])
}
